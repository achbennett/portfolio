// (c) Blackbaud, Inc.
function Game(){var j;var w;var P;var M,L;var Q;var O;var E;var b;var T=100;var I;var g;var C;var R=45;var B;var U;var v;var p;var s;var H=400;var a=700;var f=8;var K=14;var q=50;var i=4;var J=13;var N={red:"images/bg-piece-red.png",purple:"images/bg-piece-purple.png",green:"images/bg-piece-green.png",yellow:"images/bg-piece-yellow.png",orange:"images/bg-piece-orange.png",blue:"images/bg-piece-blue.png",cyan:"images/bg-piece-cyan.png"};var c={};function e(){v=$("#GameScore");U=$("#GameLevel");p=$("#OutBox");s=$("#OutBoxPapers");j=document.getElementById("GameCanvas");w=j.getContext("2d");j.tabIndex=1;P=1+Math.floor(Math.random()*7);M=i;L=J;Q=0;b=0;g=1;C=0;I=1000;B=1000;S();$("#btn-game-pause").show();O=[];for(var t=0;t<K;t++){O[t]=[];for(var o=0;o<f;o++){O[t][o]=0}}d(function(){h(M,L,P,Q,1);m();u();$(window).unbind("keydown").on("keydown",function(x){r(x)})})}function d(y){var t=0;var o=0;for(var x in N){o++}for(var x in N){c[x]=new Image();c[x].onload=function(){if(++t>=o){y()}};c[x].src=N[x]}}function m(){w.clearRect(0,0,H,a);for(var t=0;t<K;t++){for(var o=0;o<f;o++){k(o,t,O[t][o])}}}function k(o,Z,Y){var V;if(Y>0){switch(Y){case 1:V=c.cyan;break;case 2:V=c.blue;break;case 3:V=c.orange;break;case 4:V=c.yellow;break;case 5:V=c.green;break;case 6:V=c.purple;break;default:V=c.red;break}var X=o*q;var W=((K-1)-Z)*q;w.drawImage(V,X,W)}}function h(V,ab,W,Z,Y){var aa=-1;if(Y>=0){aa=W*Y}var X=true;if(W==1){if(Z==0){X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa);X=X&&n(V+2,ab,aa)}else{if(Z==1){X=X&&n(V+1,ab+1,aa);X=X&&n(V+1,ab,aa);X=X&&n(V+1,ab-1,aa);X=X&&n(V+1,ab-2,aa)}else{if(Z==2){X=X&&n(V-1,ab-1,aa);X=X&&n(V,ab-1,aa);X=X&&n(V+1,ab-1,aa);X=X&&n(V+2,ab-1,aa)}else{if(Z==3){X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa);X=X&&n(V,ab-2,aa)}}}}}if(W==2){if(Z==0){X=X&&n(V-1,ab+1,aa);X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa)}else{if(Z==1){X=X&&n(V+1,ab+1,aa);X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa)}else{if(Z==2){X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa);X=X&&n(V+1,ab-1,aa)}else{if(Z==3){X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa);X=X&&n(V-1,ab-1,aa)}}}}}if(W==3){if(Z==0){X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa);X=X&&n(V+1,ab+1,aa)}else{if(Z==1){X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa);X=X&&n(V+1,ab-1,aa)}else{if(Z==2){X=X&&n(V-1,ab-1,aa);X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa)}else{if(Z==3){X=X&&n(V-1,ab+1,aa);X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa)}}}}}if(W==4){X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa);X=X&&n(V,ab+1,aa);X=X&&n(V+1,ab+1,aa)}if(W==5){if(Z==0){X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab+1,aa);X=X&&n(V+1,ab+1,aa)}else{if(Z==1){X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa);X=X&&n(V+1,ab-1,aa)}else{if(Z==2){X=X&&n(V-1,ab-1,aa);X=X&&n(V,ab-1,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa)}else{if(Z==3){X=X&&n(V-1,ab+1,aa);X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa)}}}}}if(W==6){if(Z==0){X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa);X=X&&n(V,ab+1,aa)}else{if(Z==1){X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa);X=X&&n(V+1,ab,aa)}else{if(Z==2){X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa);X=X&&n(V,ab-1,aa)}else{if(Z==3){X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa);X=X&&n(V-1,ab,aa)}}}}}if(W==7){if(Z==0){X=X&&n(V-1,ab+1,aa);X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V+1,ab,aa)}else{if(Z==1){X=X&&n(V+1,ab+1,aa);X=X&&n(V+1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa)}else{if(Z==2){X=X&&n(V-1,ab,aa);X=X&&n(V,ab,aa);X=X&&n(V,ab-1,aa);X=X&&n(V+1,ab-1,aa)}else{if(Z==3){X=X&&n(V,ab+1,aa);X=X&&n(V,ab,aa);X=X&&n(V-1,ab,aa);X=X&&n(V-1,ab-1,aa)}}}}}return X}function n(o,W,V){if(o>=0&&o<f&&W>=0&&W<(K+2)){if(V<0){return((W<K&&o<f&&O[W][o]==0)||(W>=K))?true:false}if(W<K&&o<f){O[W][o]=V}return true}return false}function r(t){var o;if(window.event){o=window.event.keyCode}else{if(t){o=t.which}}if(o==37){h(M,L,P,Q,0);x2=M-1;if(h(x2,L,P,Q,-1)){M=x2}}else{if(o==38){h(M,L,P,Q,0);o2=(Q+1)%4;if(h(M,L,P,o2,-1)){Q=o2}}else{if(o==39){h(M,L,P,Q,0);x2=M+1;if(h(x2,L,P,Q,-1)){M=x2}}else{if(o==40){h(M,L,P,Q,0);y2=L-1;if(h(M,y2,P,Q,-1)){L=y2}}else{if(o==32){h(M,L,P,Q,0);while(h(M,L-1,P,Q,-1)){L-=1}z()}}}}}h(M,L,P,Q,1);m();t.preventDefault();return false}function z(){h(M,L,P,Q,0);y2=L-1;if(h(M,y2,P,Q,-1)){L=y2}else{h(M,L,P,Q,1);G();t2=1+Math.floor(Math.random()*7);x2=i;y2=J;o2=0;if(h(x2,y2,t2,o2,-1)){P=t2;M=x2;L=y2;Q=o2}else{D();return}}h(M,L,P,Q,1);m()}function G(){for(var x=0;x<K;x++){var t=true;for(var o=0;o<f;o++){t=t&&(O[x][o]>0)}if(t){b+=T;C+=T;if(b>=I){g++;C=0;$("#modal-level-up").hide().slideDown().fadeIn("fast",function(){setTimeout(function(){$("#modal-level-up").fadeOut()},1000)});B*=0.8;clearInterval(E);E=setInterval(z,B)}S();for(var y=x;y<(K-1);y++){for(var o=0;o<f;o++){O[y][o]=O[y+1][o]}}for(var o=0;o<f;o++){O[(K-1)][o]=0}x--}}}function S(){I=(g*(10*T));v.text("Score: "+b);U.text("Level: "+g);var o=C/I;var t=R+(p.height()-R)*o;s.css({height:t})}function u(){clearInterval(E);E=setInterval(z,B)}function A(){$("#modal-game-paused").show();clearInterval(E);$(window).unbind("keydown")}function F(){u()}function D(){clearInterval(E);$("#btn-game-pause").hide();$(window).unbind("keydown");$("#modal-game-over").show();var o="";if(g<2){o="<strong>Those grants have no mercy.</strong>"}else{if(g<3){o="<strong>Way to flex your grant processing muscles.</strong>"}else{if(g<4){o="<strong>Now you're showing the grants who's boss.</strong>"}else{if(g<5){o="<strong>So close to grant wizard status!</strong>"}else{if(g>=5){o="<strong>You're good, <em>too</em> good. Aren't there real grants you should be managing?</strong>"}}}}}$("#game-over-results").html("You reached <strong>Level "+g+"</strong> with a final score of <strong>"+b+'</strong>!<br><h4>Assessment:</h4><div class="game-assessment">'+o+"</div>")}var l=function(){$("#btn-game-start").on("click",function(o){o.preventDefault();$("#modal-game-start").hide();e()});$("#btn-game-pause").on("click",function(o){o.preventDefault();A();$(this).hide()});$("#btn-game-resume").on("click",function(o){o.preventDefault();$("#modal-game-paused").hide();u();$("#btn-game-pause").show();$(window).unbind("keydown").on("keydown",function(t){r(t)})});$("#btn-game-again").on("click",function(o){o.preventDefault();$("#modal-game-over").hide();e()})}();return{}}var game=new Game();